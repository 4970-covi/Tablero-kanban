
<div class="kanban-container"><!-- Contenedor -->
    
      <button class="open-menu-btn" (click)="menuAbierto = !menuAbierto">â˜°</button> <!-- BotÃ³n para abrir/cerrar menÃº -->

      <div class="sidebar" [class.open]="menuAbierto"> <!-- MenÃº lateral izquierdo que se abre o cierra segÃºn la variable menuAbierto -->
        <h3>{{'Encabezado.MenuU' | translate}}</h3> <!-- TÃ­tulo del menÃº, traducido segÃºn el idioma seleccionado -->
        <button (click)="toggleDarkMode()">ğŸŒ“ {{ 'Encabezado.BtModoOscuro' | translate }}</button> <!-- BotÃ³n para activar o desactivar el modo oscuro -->

        <div style="position: relative;"> <!-- Contenedor relativo para el menÃº desplegable de idiomas -->
          <button (click)="toggleIdiomas()">ğŸŒ Cambiar idioma</button> <!-- BotÃ³n para mostrar u ocultar el selector de idiomas -->

          <div *ngIf="mostrarIdiomas" class="dropdown-menu"> <!-- MenÃº desplegable que solo se muestra si mostrarIdiomas es true -->
            <button (click)="cambiarIdioma('es')">EspaÃ±ol</button> <!-- BotÃ³n para cambiar idioma a espaÃ±ol -->
            <button (click)="cambiarIdioma('en')">English</button> <!-- BotÃ³n para cambiar idioma a inglÃ©s -->
            <button (click)="cambiarIdioma('fr')">FranÃ§ais</button> <!-- BotÃ³n para cambiar idioma a francÃ©s -->
            <button (click)="cambiarIdioma('de')">Deutsch</button> <!-- BotÃ³n para cambiar idioma a alemÃ¡n -->
          </div>
        </div>
      </div>

    <h1>{{ 'Encabezado.TITULO' | translate }}</h1> <!-- TÃ­tulo principal traducido segÃºn idioma -->

    <!-- Filtros para buscar y clasificar tareas -->
    <div class="filtros">
      
      <!-- Filtro por Estado -->
      <select [(ngModel)]="estadoSeleccionado" (change)="seleccionarEstado($event)"> <!-- Enlace bidireccional con estadoSeleccionado y evento al cambiar -->
        <option value="">{{ 'Encabezado.SelecEstado' | translate }}</option> <!-- OpciÃ³n por defecto, sin filtro -->
        <option *ngFor="let estado of estadosDisponibles" [value]="estado.descripcion"> <!-- Opciones dinÃ¡micas por cada estado disponible -->
          {{ estado.descripcion }} <!-- Mostrar descripciÃ³n del estado -->
        </option>
      </select>

      <!-- Filtro por Tipo de tarea -->
      <select [(ngModel)]="tipoSeleccionado" (change)="seleccionarTipo($event)"> <!-- Enlace bidireccional con tipoSeleccionado y evento al cambiar -->
        <option [ngValue]="null">{{'Encabezado.SelecTipo' | translate}}</option> <!-- OpciÃ³n por defecto sin selecciÃ³n -->
        <option *ngFor="let tipo of tiposTareaDisponibles" [ngValue]="tipo.tipo_Tarea"> <!-- Opciones dinÃ¡micas segÃºn tipos de tarea -->
          {{ tipo.descripcion }} <!-- Mostrar descripciÃ³n del tipo -->
        </option>
      </select>

      <!-- Filtro por Prioridad -->
      <select [(ngModel)]="prioridadSeleccionada" (change)="aplicarFiltro()"> <!-- Enlace bidireccional con prioridadSeleccionada y aplicar filtro al cambiar -->
        <option [ngValue]="null">{{'Encabezado.SelectPrioridad'| translate}}</option> <!-- OpciÃ³n por defecto sin filtro -->
        <option *ngFor="let prioridad of prioridadesDisponibles" [ngValue]="prioridad.nivel_Prioridad"> <!-- Opciones dinÃ¡micas segÃºn prioridades disponibles -->
          {{ prioridad.nombre }} <!-- Mostrar nombre de la prioridad -->
        </option>
      </select>


    <!-- Referencia -->
    <div class="contenedor-input-referencia">
      <input
        type="text"
        [(ngModel)]="filtroReferencia" 
        (input)="buscarPorReferencia()" 
        (keydown.enter)="confirmarReferenciaConEnter()"
        [placeholder]="'Encabezado.BuscReferencia' | translate"
      />
      <button (click)="limpiarFiltros()">{{'Encabezado.BtFiltro' | translate}}</button><!-- BotÃ³n para limpiar filtros con texto traducido -->

      <div *ngIf="mostrarResultadosFlotantes" class="ventana-resultados"> <!-- Ventana emergente que se muestra si hay resultados para mostrar -->
        <div class="cabecera-ventana">
          <h4>{{'Encabezado.VentanaEmergente' | translate}}</h4> <!-- TÃ­tulo traducido de la ventana emergente -->
          <button (click)="mostrarResultadosFlotantes = false" class="cerrar-ventana">âœ–</button> <!-- BotÃ³n para cerrar la ventana emergente -->
        </div>
        <ul class="lista-referencias">
          <li
            *ngFor="let r of resultadosReferencia" 
            (click)="filtrarPorReferenciaSeleccionada(r)" 
            class="opcion-referencia"
          >
            <strong>{{ r.referencia }}</strong> â€“ {{ r.descripcion }}<br /> <!-- Muestra referencia y descripciÃ³n -->
            <small>ID: {{ r.referencia_Id }}</small> <!-- Muestra el ID de referencia -->
          </li>
        </ul>
      </div>
      
<div class="contenedor-input-usuario"><!--campo de bÃºsqueda para que el usuario escriba texto y se realice una bÃºsqueda dinÃ¡mica de usuarios. TambiÃ©n responde al presionar Enter para confirmar la selecciÃ³n. El texto del placeholder se traduce segÃºn el idioma activo.-->
  <input
    type="text"
    [(ngModel)]="filtroUsuario"
    (input)="buscarPorUsuario()"
    (keydown.enter)="confirmarUsuarioConEnter()"
    [placeholder]= "'Encabezado.BuscUsuario'| translate"
  />

  <div *ngIf="mostrarUsuariosFlotantes" class="ventana-resultados"><!--Muestra una ventana emergente de los usuarios coincidentes-->
    <div class="cabecera-ventana">
      <h4>{{'Encabezado.VentanaEmergente' | translate}}</h4>
      <button (click)="mostrarUsuariosFlotantes = false" class="cerrar-ventana">âœ–</button>
    </div>
    <ul class="lista-referencias">
      <li
        *ngFor="let u of usuariosCoincidentes"
        (click)="filtrarPorUsuarioSeleccionado(u)"
        class="opcion-referencia"
      >
        <strong>{{ u.userName }}</strong> â€“ {{ u.name }}<br />
        <small>{{ u.email }}</small>
      </li>
    </ul>
    
  </div>
</div>

    </div>
  </div>

  <!-- PestaÃ±as Existentes -->
  <div class="tab-container">
    <button [class.active-tab]="vistaActiva === 'todas'" (click)="cambiarVista('todas')">{{'Pestanias.TarTodas' | translate}}</button>
    <button [class.active-tab]="vistaActiva === 'creadas'" (click)="cambiarVista('creadas')">{{'Pestanias.TarCreadas' | translate}}</button>
    <button [class.active-tab]="vistaActiva === 'asignadas'" (click)="cambiarVista('asignadas')">{{'Pestanias.TarAsignadas' | translate}}</button>
    <button [class.active-tab]="vistaActiva === 'invitaciones'" (click)="cambiarVista('invitaciones')">{{'Pestanias.TarInvitaciones' | translate}}</button>
  </div>


  <!-- Tablero Kanban -->
  <div class="kanban-wrapper"> <!-- Contenedor general que envuelve el tablero Kanban -->
    <div class="kanban-board"> <!-- Contenedor del tablero Kanban donde se muestran las columnas -->
      <div class="column" *ngFor="let estado of obtenerEstadosUnicos()"> <!-- Repite una columna por cada estado Ãºnico obtenido de las tareas -->
        <div class="column-title">{{ estado }}</div> <!-- Muestra el nombre del estado en el tÃ­tulo de la columna -->
        <div class="task" *ngFor="let tarea of getTareasPorEstado(estado)"> <!-- Repite una tarjeta para cada tarea filtrada que corresponde a este estado -->
          <div class="task-prioridad" [ngStyle]="{ 'background-color': getColorPrioridad(tarea.nivel_Prioridad) }"></div> <!-- Indicador visual de prioridad con color dinÃ¡mico -->
          <div class="task-content"> <!-- Contenedor del contenido visible de la tarea -->
            <strong>{{'Tareas.ID' | translate}}:</strong> {{ tarea.iD_Tarea }}<br /> <!-- Etiqueta "ID" traducida y valor de ID -->
            <strong>{{'Tareas.Descripcion' | translate}}:</strong> {{ tarea.descripcion }}<br /> <!-- Etiqueta "DescripciÃ³n" traducida y descripciÃ³n -->
            <strong>{{'Tareas.Tipo' | translate}}:</strong> {{ tarea.descripcion_Tipo_Tarea }}<br /> <!-- Etiqueta "Tipo" traducida y tipo -->
            <strong>{{'Tareas.Prioridad' | translate}}:</strong> {{ tarea.nom_Nivel_Prioridad }}<br /> <!-- Etiqueta "Prioridad" traducida y nivel -->
            <strong>{{'Tareas.Ref' | translate}}:</strong> {{ tarea.descripcion_Referencia }} ({{ tarea.referencia }})<br /> <!-- Etiqueta "Referencia" traducida y detalles -->
            <strong>{{'Tareas.Fecha' | translate}}:</strong> {{ tarea.fecha_Inicial | date: 'dd/MM/yyyy HH:mm' }}<br /> <!-- Etiqueta "Fecha" traducida y fecha formateada -->
            <strong>{{'Tareas.Invitados' | translate}}:</strong> <!-- Etiqueta "Invitados" traducida -->
            <span *ngIf="(tareaInvitados[tarea.iD_Tarea]?.length ?? 0) > 0"> <!-- Si hay invitados para la tarea -->
              {{ getPrimerInvitado(tarea.iD_Tarea) }} <!-- Mostrar el primer invitado -->
              <span *ngIf="getCantidadRestante(tarea.iD_Tarea) > 0" [title]="getRestoInvitadosTooltip(tarea.iD_Tarea)"> <!-- Si hay mÃ¡s invitados, mostrar cantidad y tooltip -->
                +{{ getCantidadRestante(tarea.iD_Tarea) }} mÃ¡s <!-- Texto indicando nÃºmero de invitados adicionales -->
              </span>
            </span>
            <span *ngIf="!tareaInvitados[tarea.iD_Tarea]?.length"> <!-- Si no hay invitados -->
              Sin invitado <!-- Mostrar texto indicando ausencia de invitados -->
            </span>
            </div> 
          </div> 
        </div> 
      </div> 
    </div> 

    <!-- PaginaciÃ³n -->
    <div class="paginacion">
      <button (click)="anterior()" [disabled]="paginaActual === 1">Â«</button>

      <ng-container *ngFor="let num of paginasVisibles">
        <ng-container *ngIf="num !== -1">
          <button
            [class.activa]="num === paginaActual"
            (click)="irAPagina(num)">
            {{ num }}
          </button>
        </ng-container>
        <ng-container *ngIf="num === -1">
          <span class="separador">...</span>
        </ng-container>
      </ng-container>

      <button (click)="siguiente()" [disabled]="paginaActual === paginasTotales">Â»</button>
    </div>

